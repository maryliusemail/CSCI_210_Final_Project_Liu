<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>RPS Tournament</title>
</head>
<body>
  <h1>RPS Tournament</h1>
  <p>10 rounds per match. Winner becomes Player 1 for the next match.</p>

  <h2>Match Status</h2>
  <p>Round: {{ state.round }} / {{ state.max_rounds }}</p>

  {% if state.locked_winner_as_p1 %}
    <p><b>Winner locked as Player 1 for next match.</b></p>
  {% endif %}

  {% if state.p1 and state.p2 %}
    <p><b>Player 1:</b> {{ state.p1 }} | <b>Player 2:</b> {{ state.p2 }}</p>
  {% elif state.p1 and not state.p2 and state.locked_winner_as_p1 %}
    <p><b>Next Match Player 1:</b> {{ state.p1 }} (locked). Enter a new Player 2.</p>
  {% else %}
    <p>Start a match by entering players below.</p>
  {% endif %}

  {% if state.round == state.max_rounds %}
    <h3>Match Complete</h3>
    {% if state.winner %}
      <p><b>Winner:</b> {{ state.winner }}</p>
    {% else %}
      <p><b>Overall Result:</b> Tie (Player 1 remains Player 1)</p>
    {% endif %}
  {% endif %}

  <hr/>

  <h2>Start Match</h2>
  <form method="post" action="/start">
    <label>Player 1:</label><br/>
    {% if state.p1 and state.locked_winner_as_p1 %}
      <input name="p1" value="{{ state.p1 }}" readonly><br/><br/>
    {% else %}
      <input name="p1" placeholder="Enter Player 1 name"><br/><br/>
    {% endif %}

    <label>Player 2:</label><br/>
    <input name="p2" placeholder="Enter Player 2 name"><br/><br/>

    <button type="submit">Start / Restart Match</button>
  </form>

  <hr/>

  <h2>Play Round</h2>
  <form method="post" action="/play">
    <label>Player 1 move:</label><br/>
    <select name="p1_move">
      <option value="rock">rock</option>
      <option value="paper">paper</option>
      <option value="scissors">scissors</option>
    </select><br/><br/>

    <label>Player 2 move:</label><br/>
    <select name="p2_move">
      <option value="rock">rock</option>
      <option value="paper">paper</option>
      <option value="scissors">scissors</option>
    </select><br/><br/>

    <button type="submit">Submit Round</button>
  </form>

  <hr/>

  <h2>Round Score</h2>
  <p>{{ state.p1 or "P1" }}: {{ state.p1_round_wins }}</p>
  <p>{{ state.p2 or "P2" }}: {{ state.p2_round_wins }}</p>

  <h2>Round History</h2>
  {% if state.round_history and state.round_history|length > 0 %}
    <table border="1" cellpadding="6" cellspacing="0">
      <tr>
        <th>Round</th>
        <th>P1 Move</th>
        <th>P2 Move</th>
        <th>Winner</th>
      </tr>
      {% for r in state.round_history %}
      <tr>
        <td>{{ r.round }}</td>
        <td>{{ r.p1_move }}</td>
        <td>{{ r.p2_move }}</td>
        <td>{{ r.round_winner or "tie" }}</td>
      </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>No rounds played yet.</p>
  {% endif %}

  <hr/>

  <h2>Leaderboard Preview (Top 10 by score)</h2>
  {% if leaderboard.by_score and leaderboard.by_score|length > 0 %}
    <table border="1" cellpadding="6" cellspacing="0">
      <tr>
        <th>Name</th>
        <th>Score</th>
        <th>W</th>
        <th>L</th>
        <th>T</th>
      </tr>
      {% for p in leaderboard.by_score[:10] %}
      <tr>
        <td>{{ p.name }}</td>
        <td>{{ p.score }}</td>
        <td>{{ p.wins }}</td>
        <td>{{ p.losses }}</td>
        <td>{{ p.ties }}</td>
      </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>No players yet.</p>
  {% endif %}

  <p><a href="/leaderboard">View full leaderboard</a></p>
</body>
</html>
